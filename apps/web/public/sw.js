var s="https://api.mycrumbs.xyz/leafwatch/impressions";var n=null,o=new Set,a=()=>{let i=Array.from(o);i.length>0&&n&&(o.clear(),fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({viewer_id:n,ids:i}),keepalive:!0}).then(()=>{}).catch(()=>{}))};async function l(){self.skipWaiting()}self.addEventListener("push",i=>{let t=i.data?i.data.json():null,e={body:t?.body,icon:"/icons/icon-192x192.png",badge:"/icons/badge-96x96.png",actions:[{action:"open_url",title:"View"},{action:"snooze",title:"Snooze"}],data:{url:t?.url}};i.waitUntil(self.registration.showNotification(t?.title,e))});self.addEventListener("notificationclick",i=>{i.notification.close(),i.action==="open_url"?self.clients.openWindow(i.notification.data.url):i.action});var c=async()=>{await self.clients.claim()},d=i=>{let t=i.request.clone(),{origin:e}=new URL(t.url);self.location.origin===e&&i.respondWith};self.addEventListener("message",i=>{i.data&&i.data.type==="PUBLICATION_VISIBLE"&&(o.add(i.data.id),n=i.data.viewerId)});setInterval(a,5e3);self.addEventListener("fetch",d);self.addEventListener("install",i=>i.waitUntil(l()));self.addEventListener("activate",i=>i.waitUntil(c()));
